<!doctype html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Encargado - UABC</title>
    <link rel="stylesheet" href="css/dashboard-encargado.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <div class="sidebar">
        <div class="logo">
            <img src="img/Isotipo.png" alt="UABC Logo">
            <p>Universidad Aut√≥noma de Baja California</p>
            <small>Panel del Encargado</small>
        </div>

        <nav>
            <a href="#" onclick="mostrarSeccion('estadisticas')" class="active">
                <span class="icono"></span> Dashboard
            </a>
            <a href="#" onclick="mostrarSeccion('solicitudes')">
                <span class="icono"></span> Solicitudes de Pr√©stamo
            </a>
            <a onclick="mostrarSeccion('laboratorios')">
                <span class="icono"></span> Gesti√≥n de Laboratorios
            </a>
            <a onclick="mostrarSeccion('mantenimiento')">
                <span class="icono"></span> Mantenimiento
            </a>
            <a onclick="mostrarSeccion('usuarios')">
                <span class="icono"></span> Gesti√≥n de Usuarios
            </a>
            <a id="logout">
                <span class="icono"></span> Cerrar sesi√≥n
            </a>
        </nav>
    </div>

    <div class="contenido">
        <!-- Secci√≥n de Estad√≠sticas -->
        <div id="estadisticas" class="seccion">
            <h2>Dashboard - Estad√≠sticas</h2>
            
            <!-- Nuevo widget de ubicaci√≥n y hora -->
            <div class="location-time-widget">
                <div class="widget-header">
                    <h3>üåç Informaci√≥n Actual</h3>
                </div>
                <div class="widget-content">
                    <div class="time-section">
                        <div class="current-time" id="currentTime">--:--:--</div>
                        <div class="current-date" id="currentDate">--</div>
                    </div>
                    <div class="location-section">
                        <div class="location-info">
                            <div class="location-item">
                                <span class="location-label">üìç Ubicaci√≥n:</span>
                                <span class="location-value" id="currentLocation">Obteniendo...</span>
                            </div>
                            <div class="location-item">
                                <span class="location-label">üå°Ô∏è Temperatura:</span>
                                <span class="location-value" id="currentTemperature">--¬∞C</span>
                            </div>
                            <div class="location-item">
                                <span class="location-label">üèõÔ∏è Campus:</span>
                                <span class="location-value" id="campusInfo">UABC</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tarjetas de m√©tricas existentes -->
            <div class="metricas-grid">
                <div class="metrica-card">
                    <h3>Total Laboratorios</h3>
                    <div class="numero" id="total-laboratorios">--</div>
                </div>
                <div class="metrica-card">
                    <h3>Total Usuarios</h3>
                    <div class="numero" id="total-usuarios">--</div>
                </div>
                <div class="metrica-card">
                    <h3>Pr√©stamos este Mes</h3>
                    <div class="numero" id="prestamos-mes">--</div>
                </div>
                <div class="metrica-card">
                    <h3>Labs Disponibles</h3>
                    <div class="numero" id="labs-disponibles">--</div>
                </div>
            </div>

            <!-- Gr√°ficas existentes -->
            <div class="graficas-grid">
                <div class="grafica-container">
                    <h3>Estado de Laboratorios</h3>
                    <canvas id="grafica-laboratorios-estados"></canvas>
                </div>
                <div class="grafica-container">
                    <h3>Pr√©stamos por Mes</h3>
                    <canvas id="grafica-prestamos-mes"></canvas>
                </div>
                <div class="grafica-container">
                    <h3>Usuarios por Rol</h3>
                    <canvas id="grafica-usuarios-rol"></canvas>
                </div>
                <div class="grafica-container">
                    <h3>Laboratorios M√°s Populares</h3>
                    <canvas id="grafica-labs-populares"></canvas>
                </div>
            </div>
        </div>

        <!-- SECCI√ìN: SOLICITUDES DE PR√âSTAMO -->
        <div id="solicitudes" class="seccion" style="display:none;">
            <h3>Solicitudes de Pr√©stamo</h3>

            <table id="tablaEncargado">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Usuario</th>
                        <th>Correo</th>
                        <th>Laboratorio</th>
                        <th>Fecha Pr√©stamo</th>
                        <th>Estado</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 20px;">
                            Cargando solicitudes...
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- SECCI√ìN: GESTI√ìN DE LABORATORIOS -->
        <div id="laboratorios" class="seccion" style="display:none;">
            <h3>Gesti√≥n de Laboratorios</h3>

            <div style="margin-bottom: 20px;">
                <button class="btn btn-primary" onclick="mostrarFormLaboratorio()">Nuevo Laboratorio</button>
            </div>

            <!-- Formulario para nuevo/editar laboratorio -->
            <div id="formLaboratorioContainer">
                <h4>Laboratorio</h4>
                <form id="formLaboratorio">
                    <input type="hidden" id="lab_id_laboratorio" name="id_laboratorio">
                    
                    <div class="form-group">
                        <label for="lab_nombre">Nombre:</label>
                        <input type="text" id="lab_nombre" name="nombre" required>
                    </div>

                    <div class="form-group">
                        <label for="lab_ubicacion">Ubicaci√≥n:</label>
                        <input type="text" id="lab_ubicacion" name="ubicacion" required>
                    </div>

                    <div class="form-group">
                        <label for="lab_capacidad">Capacidad:</label>
                        <input type="number" id="lab_capacidad" name="capacidad" min="1" required>
                    </div>

                    <div class="form-group">
                        <label for="lab_estado">Estado:</label>
                        <select id="lab_estado" name="estado" required>
                            <option value="disponible">Disponible</option>
                            <option value="mantenimiento">En Mantenimiento</option>
                            <option value="fuera_servicio">Fuera de Servicio</option>
                        </select>
                    </div>

                    <button type="submit" class="btn btn-primary">Guardar</button>
                    <button type="button" class="btn btn-rojo" onclick="cancelarFormLaboratorio()">Cancelar</button>
                </form>
            </div>

            <!-- Lista de laboratorios -->
            <table id="tablaLaboratorios">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nombre</th>
                        <th>Ubicaci√≥n</th>
                        <th>Capacidad</th>
                        <th>Estado</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 20px;">
                            Cargando laboratorios...
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- SECCI√ìN: MANTENIMIENTO -->
        <div id="mantenimiento" class="seccion" style="display:none;">
            <h3>Mantenimiento de Laboratorios</h3>

            <!-- Formulario de registro de mantenimiento -->
            <div id="formMantenimiento">
                <h4>Registrar Nuevo Mantenimiento</h4>
                
                <form id="formMantenimientoForm">
                    <div class="form-group">
                        <label for="mant_laboratorio">Laboratorio:</label>
                        <select id="mant_laboratorio" name="id_laboratorio" required>
                            <option value="">Seleccionar laboratorio...</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="mant_tipo">Tipo de mantenimiento:</label>
                        <select id="mant_tipo" name="tipo" required>
                            <option value="">Seleccionar tipo...</option>
                            <option value="preventivo">Preventivo</option>
                            <option value="correctivo">Correctivo</option>
                            <option value="limpieza">Limpieza</option>
                            <option value="actualizacion">Actualizaci√≥n</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="mant_descripcion">Descripci√≥n:</label>
                        <textarea id="mant_descripcion" name="descripcion" placeholder="Describe el trabajo de mantenimiento a realizar..." required></textarea>
                    </div>

                    <div class="form-group">
                        <label for="mant_fecha_inicio">Fecha de inicio:</label>
                        <input type="datetime-local" id="mant_fecha_inicio" name="fecha_inicio" required>
                    </div>

                    <div class="form-group">
                        <label for="mant_fecha_fin">Fecha estimada de finalizaci√≥n:</label>
                        <input type="datetime-local" id="mant_fecha_fin" name="fecha_fin" required>
                    </div>

                    <button type="submit" class="btn btn-primary">Registrar Mantenimiento</button>
                    <button type="reset" class="btn btn-amarillo">Limpiar Formulario</button>
                </form>
            </div>

            <!-- Lista de mantenimientos -->
            <table id="tablaMantenimientos">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Laboratorio</th>
                        <th>Tipo</th>
                        <th>Descripci√≥n</th>
                        <th>Fecha Inicio</th>
                        <th>Fecha Fin</th>
                        <th>Estado</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 20px;">
                            Cargando mantenimientos...
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- SECCI√ìN: GESTI√ìN DE USUARIOS -->
        <div id="usuarios" class="seccion" style="display:none;">
            <h3>Gesti√≥n de Usuarios</h3>
            
            <div style="margin-bottom: 20px;">
                <button onclick="agregarNuevoUsuario()" class="btn btn-verde">
                    Nuevo Usuario
                </button>
            </div>
            
            <table id="tablaUsuarios">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nombre</th>
                        <th>Correo</th>
                        <th>Rol</th>
                        <th>Fecha Registro</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 20px;">
                            Cargando usuarios...
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Scripts existentes -->
    <script src="js/logout.js"></script>
    <script src="js/dashboard.js"></script>
    <script src="js/usuarios.js"></script>
    <script src="js/encargado.js"></script>
    <script src="js/mantenimientos.js"></script>
    <script src="js/chart.js"></script>
    <script src="js/dashboard-encargado.js"></script>
    <!-- Nuevo script para geolocalizaci√≥n -->
    <script src="js/geolocation.js"></script>
</body>
</html>
